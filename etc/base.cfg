[buildout]
newest = false
unzip = true
relative-paths = true
develop = .

parts =
    api
    supervisord-config
    redis01-config
    redis02-config
    nginx-config
    cleanpyc
    shell

eggs =
    supervisor

[api]
recipe = zc.recipe.egg
interpreter = python
eggs = ${buildout:eggs}
    storage-api
    gunicorn
extra-paths = 
	${buildout:directory}/config 

[supervisord-config]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/supervisord.conf.in
output = ${buildout:directory}/etc/supervisord.conf

[redis01-config]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/redis_01.conf.in
output = ${buildout:directory}/etc/redis_01.conf

[redis02-config]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/redis_02.conf.in
output = ${buildout:directory}/etc/redis_02.conf

[nginx-config]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/nginx.conf.in
output = ${buildout:directory}/etc/nginx.conf

[cleanpyc]
recipe = plone.recipe.command
command = find ${buildout:directory}/apps -iname '*.pyc' -delete

[shell]
recipe = iw.recipe.cmd
on_install = true

cmds =
    echo "nginx -c ${buildout:directory}/etc/nginx.conf" > ${buildout:directory}/bin/nginx
    chmod +x ${buildout:directory}/bin/nginx